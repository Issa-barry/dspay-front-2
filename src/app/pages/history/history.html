<div class="history-page card">
  <!-- Header -->
  <div class="page-header">
    <button
      pButton
      icon="pi pi-arrow-left"
      class="p-button-text back-button"
      type="button"
      (click)="goBack()"
      aria-label="Retour"
    ></button>

    <div class="header-content">
      <h1 class="page-title">Historique des transferts</h1>
      <p class="page-subtitle">Consultez tous vos transferts</p>
    </div>
  </div>

  <!-- Search bar -->
  <div class="search-bar">
    <span class="p-input-icon-left">
      <i class="pi pi-search" aria-hidden="true"></i>
      <input
        type="text"
        pInputText
        [(ngModel)]="searchQuery"
        (input)="onSearchInput(searchQuery)"
        placeholder="Rechercher un transfert..."
        class="search-input"
        autocomplete="off"
      />
    </span>
  </div>

  <!-- Content -->
  <ng-container *ngIf="displayedTransfers?.length as count; else empty">
    <!-- Transfers list -->
    <div class="transfers-list" *ngIf="count > 0">
      <div
        *ngFor="let transfer of displayedTransfers; trackBy: trackByTransferId"
        class="transfer-item"
        role="button"
        tabindex="0"
        (click)="viewDetails(transfer)"
        (keydown.enter)="viewDetails(transfer)"
      >
        <div class="transfer-main">
          <div class="transfer-info">
            <h3 class="beneficiary-name">
              {{ transfer.beneficiaire?.nom_complet || (transfer.beneficiaire?.prenom + ' ' + transfer.beneficiaire?.nom) || '—' }}
            </h3>

            <p class="transfer-date">
              <i class="pi pi-calendar" aria-hidden="true"></i>
              {{ formatDate(transfer.created_at) }}
            </p>

            <p class="transfer-reference">
              <i class="pi pi-tag" aria-hidden="true"></i>
              {{ transfer.code || '—' }}
            </p>
          </div>

          <div class="transfer-amount">
            <div class="amount-sent">
              <span class="amount">
                {{ formatAmount(transfer.total_ttc) }}
                {{ transfer.devise_source?.tag || 'EUR' }}
              </span>
              <span class="label">Envoyé</span>
            </div>

            <i class="pi pi-arrow-right arrow-icon" aria-hidden="true"></i>

            <div class="amount-received">
              <span class="amount">
                {{ formatAmount(transfer.total_gnf || transfer.amount) }}
                {{ transfer.devise_cible?.tag || 'GNF' }}
              </span>
              <span class="label">Reçu</span>
            </div>
          </div>
        </div>

        <div class="transfer-footer">
          <div class="payment-method">
            <i class="pi pi-mobile" aria-hidden="true"></i>
            {{ transfer.serviceId || '—' }}
          </div>

          <p-tag
            [value]="getStatusLabel(transfer.statut)"
            [severity]="getStatusSeverity(transfer.statut)"
          ></p-tag>
        </div>

        <i class="pi pi-chevron-right mobile-chevron" aria-hidden="true"></i>
      </div>
    </div>

    <!-- Load More Button -->
    <div class="load-more-container" *ngIf="hasMore && count > 0">
      <button
        pButton
        type="button"
        label="Charger plus"
        icon="pi pi-angle-down"
        class="p-button-outlined load-more-btn"
        (click)="loadMore()"
        [disabled]="loading"
      ></button>
    </div>
  </ng-container>

  <!-- Empty state -->
  <ng-template #empty>
    <div class="empty-state">
      <i class="pi pi-history empty-icon" aria-hidden="true"></i>
      <h3>Aucun transfert trouvé</h3>
      <p *ngIf="searchQuery; else noSearch">Aucun résultat pour "{{ searchQuery }}"</p>
      <ng-template #noSearch>
        <p>Vous n'avez pas encore effectué de transfert</p>
      </ng-template>
    </div>
  </ng-template>
</div>
