<!-- Toast pour les notifications -->
<p-toast position="top-right"></p-toast>

<!-- Wrapper avec padding pour le bouton fixe -->
<div class="content-wrapper">
  <div class="flex flex-col gap-8">
    <!-- Titre -->
    <div class="text-surface-900 dark:text-surface-0 font-semibold text-lg leading-tight">
      Vérification d'identité (KYC)
    </div>

    <!-- Message d'information -->
    <!-- <div class="p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl">
      <div class="flex items-start gap-3">
        <i class="pi pi-info-circle text-blue-600 dark:text-blue-400 text-xl mt-1"></i>
        <div class="flex-1">
          <h3 class="text-surface-900 dark:text-surface-0 font-semibold mb-1 text-sm">
            Pourquoi cette vérification ?
          </h3>
          <p class="text-surface-600 dark:text-surface-300 text-sm">
            Pour votre sécurité et conformément aux réglementations, nous devons vérifier votre identité. 
            Vos informations sont sécurisées et confidentielles.
          </p>
        </div>
      </div>
    </div> -->

    <!-- Formulaire KYC -->
    <div class="flex flex-col gap-6">
      <!-- Nationalité -->
      <div class="flex flex-col gap-2">
        <label for="nationality" class="text-surface-900 dark:text-surface-0">
          Nationalité <span class="text-red-500">*</span>
        </label>
        <p-select
          id="nationality"
          [(ngModel)]="kycData.nationality"
          [options]="nationalities"
          optionLabel="name"
          placeholder="Sélectionnez votre nationalité"
          [filter]="true"
          filterBy="name"
          [showClear]="true"
          styleClass="w-full">
        </p-select>
      </div>

      <!-- Type de document -->
      <div class="flex flex-col gap-2">
        <label for="docType" class="text-surface-900 dark:text-surface-0">
          Type de pièce d'identité du pays de residence <span class="text-red-500">*</span>
        </label>
        <p-select
          id="docType"
          [(ngModel)]="kycData.documentType"
          [options]="documentTypes"
          optionLabel="name"
          placeholder="Sélectionnez le type de document"
          [showClear]="true"
          styleClass="w-full">
        </p-select>
      </div>

      <!-- Numéro de document -->
      <div class="flex flex-col gap-2">
        <label for="docNumber" class="text-surface-900 dark:text-surface-0">
          Numéro du document <span class="text-red-500">*</span>
        </label>
        <input
          id="docNumber"
          type="text"
          pInputText
          class="w-full"
          [(ngModel)]="kycData.documentNumber"
          placeholder="Ex: 1234567890"
          [maxlength]="30" />
      </div>

      <!-- Dates sur la même ligne (desktop) -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Date de délivrance -->
        <div class="flex flex-col gap-2">
          <label for="issueDate" class="text-surface-900 dark:text-surface-0">
            Date de délivrance <span class="text-red-500">*</span>
          </label>
          <p-datepicker
            id="issueDate"
            [(ngModel)]="kycData.issueDate"
            [showIcon]="true"
            iconDisplay="input"
            placeholder="jj/mm/aaaa"
            dateFormat="dd/mm/yy"
            [maxDate]="today"
            [showButtonBar]="true"
            styleClass="w-full">
          </p-datepicker>
        </div>

        <!-- Date d'expiration -->
        <div class="flex flex-col gap-2">
          <label for="expiryDate" class="text-surface-900 dark:text-surface-0">
            Date d'expiration <span class="text-red-500">*</span>
          </label>
          <p-datepicker
            id="expiryDate"
            [(ngModel)]="kycData.expiryDate"
            [showIcon]="true"
            iconDisplay="input"
            placeholder="jj/mm/aaaa"
            dateFormat="dd/mm/yy"
            [minDate]="minExpiryDate"
            [showButtonBar]="true"
            styleClass="w-full">
          </p-datepicker>
        </div>
      </div>

      <!-- Upload de document -->
      <div class="flex flex-col gap-2">
        <label class="text-surface-900 dark:text-surface-0">
          Pièce d'identité (Photo ou PDF) <span class="text-red-500">*</span>
        </label>
        
        <div class="border-2 border-dashed border-surface-300 dark:border-surface-600 rounded-xl p-6 text-center">
          <p-fileUpload
            #fileUpload
            mode="basic"
            name="document"
            accept="image/*,application/pdf"
            [maxFileSize]="5000000"
            [auto]="true"
            [customUpload]="true"
            (uploadHandler)="onFileSelect($event)"
            chooseLabel="Choisir un fichier"
            chooseIcon="pi pi-upload"
            [chooseButtonProps]="{ severity: 'secondary', outlined: true }"
            styleClass="w-full">
          </p-fileUpload>
          
          <!-- Fichier uploadé -->
          <div *ngIf="uploadedFileName" class="mt-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2">
                <i class="pi pi-check-circle text-green-600 dark:text-green-400"></i>
                <span class="text-surface-900 dark:text-surface-0 font-medium text-sm">{{ uploadedFileName }}</span>
              </div>
              <button 
                type="button"
                class="text-red-500 hover:text-red-700"
                (click)="onFileRemove(); fileUpload.clear()">
                <i class="pi pi-times"></i>
              </button>
            </div>
          </div>

          <!-- Instructions -->
          <div class="mt-4 text-surface-500 dark:text-surface-400 text-xs">
            <p>• Formats acceptés: JPG, PNG, PDF</p>
            <p>• Taille maximale: 5 MB</p>
            <p>• Le document doit être lisible et en couleur</p>
          </div>
        </div>
      </div>

      <!-- Message d'avertissement -->
      <div class="p-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl">
        <div class="flex items-start gap-3">
          <i class="pi pi-exclamation-triangle text-amber-600 dark:text-amber-400 text-xl mt-1"></i>
          <div class="flex-1">
            <p class="text-surface-900 dark:text-surface-0 font-semibold text-sm mb-1">
              Assurez-vous que :
            </p>
            <ul class="text-surface-600 dark:text-surface-300 text-sm list-disc list-inside space-y-1">
              <li>Votre document est valide et non expiré</li>
              <li>Toutes les informations sont clairement visibles</li>
              <li>La photo est nette et sans reflet</li>
              <li>Les informations correspondent à votre profil</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bouton fixe en bas sur mobile -->
<div class="button-fixed-wrapper">
  <p-button 
    label="Soumettre la vérification"
    icon="pi pi-send"
    iconPos="right"
    [disabled]="!isFormValid() || isSubmitting"
    [loading]="isSubmitting"
    (onClick)="submitKyc()">
  </p-button>
</div>